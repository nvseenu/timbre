<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.timbre.profiling documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Timbre</span> <span class="project-version">4.6.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>taoensso</span></div></div></li><li class="depth-2"><a href="taoensso.timbre.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timbre</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>appenders</span></div></div></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>3rd-party</span></div></div></li><li class="depth-5 branch"><a href="taoensso.timbre.appenders.3rd-party.gelf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gelf</span></div></a></li><li class="depth-5 branch"><a href="taoensso.timbre.appenders.3rd-party.irclj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>irclj</span></div></a></li><li class="depth-5 branch"><a href="taoensso.timbre.appenders.3rd-party.postgresql.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>postgresql</span></div></a></li><li class="depth-5 branch"><a href="taoensso.timbre.appenders.3rd-party.rolling.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rolling</span></div></a></li><li class="depth-5 branch"><a href="taoensso.timbre.appenders.3rd-party.rotor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rotor</span></div></a></li><li class="depth-5"><a href="taoensso.timbre.appenders.3rd-party.slack.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>slack</span></div></a></li><li class="depth-4 branch"><a href="taoensso.timbre.appenders.carmine.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>carmine</span></div></a></li><li class="depth-4 branch"><a href="taoensso.timbre.appenders.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-4 branch"><a href="taoensso.timbre.appenders.example.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>example</span></div></a></li><li class="depth-4"><a href="taoensso.timbre.appenders.postal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>postal</span></div></a></li><li class="depth-3 branch current"><a href="taoensso.timbre.profiling.html"><div class="inner"><span class="tree" style="top: -362px;"><span class="top" style="height: 371px;"></span><span class="bottom"></span></span><span>profiling</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tools</span></div></div></li><li class="depth-4"><a href="taoensso.timbre.tools.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-*sacc*"><div class="inner"><span>*sacc*</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--capture-time.21"><div class="inner"><span>-capture-time!</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--elide.3F"><div class="inner"><span>-elide?</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--fn-sigs"><div class="inner"><span>-fn-sigs</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--format-stats"><div class="inner"><span>-format-stats</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--if-let-profile"><div class="inner"><span>-if-let-profile</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--if-profile"><div class="inner"><span>-if-profile</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--log-profiled"><div class="inner"><span>-log-profiled</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var--pdata-proxy"><div class="inner"><span>-pdata-proxy</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-chance"><div class="inner"><span>chance</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-defnp"><div class="inner"><span>defnp</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-dynamic-capture-.3Eprofile"><div class="inner"><span>dynamic-capture-&gt;profile</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-dynamic-capture-.3Eprofiled"><div class="inner"><span>dynamic-capture-&gt;profiled</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-fnp"><div class="inner"><span>fnp</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-merge-stats"><div class="inner"><span>merge-stats</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-nano-time"><div class="inner"><span>nano-time</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-p"><div class="inner"><span>p</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-p*"><div class="inner"><span>p*</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-profile"><div class="inner"><span>profile</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-profile-into"><div class="inner"><span>profile-into</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-profiled"><div class="inner"><span>profiled</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-profiling.3F"><div class="inner"><span>profiling?</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-pspy"><div class="inner"><span>pspy</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-pspy*"><div class="inner"><span>pspy*</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-sampling-profile"><div class="inner"><span>sampling-profile</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-start-profiling.21"><div class="inner"><span>start-profiling!</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-stats-accumulator"><div class="inner"><span>stats-accumulator</span></div></a></li><li class="depth-1"><a href="taoensso.timbre.profiling.html#var-stop-profiling.21"><div class="inner"><span>stop-profiling!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">taoensso.timbre.profiling</h1><div class="doc"><pre class="plaintext">Simple, fast, cross-platform logging profiler for Timbre.

Quick usage summary:
  1. Wrap (name) interesting forms/fns with `p`/`defnp`.
  2. Use `profiled` to get thread-local stats (a map), or
     use `profile`  to log thread-local stats.
  3. Use `dynamic-capture-&gt;profiled` to get stats captured from all threads, or
     use `dynamic-capture-&gt;profile`  to log stats captured from all threads.

Filtering and elision:
  Support ns+level elision and runtime filtering:  `p`, `profiled`, `profile`.
  Support arbitrary conditional logging (e.g sampling): `profiled`, `profile`.

How/where to use this:
  Timbre's profiling is highly optimized: even without elision, you can
  usually leave profiling code in production (e.g. for sampled profiling,
  or to detect unusual performance). Timbre's stats map is well suited
  to programmatic inspection + analysis.</pre></div><div class="public anchor" id="var-*sacc*"><h3>*sacc*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Dynamic stats accumulator, experimental
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L180">view source</a></div></div><div class="public anchor" id="var--capture-time.21"><h3>-capture-time!</h3><div class="usage"><code>(-capture-time! pdata id t-elapsed)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L80">view source</a></div></div><div class="public anchor" id="var--elide.3F"><h3>-elide?</h3><div class="usage"><code>(-elide? level-form ns-str-form)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L153">view source</a></div></div><div class="public anchor" id="var--fn-sigs"><h3>-fn-sigs</h3><div class="usage"><code>(-fn-sigs fn-name sigs)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L508">view source</a></div></div><div class="public anchor" id="var--format-stats"><h3>-format-stats</h3><div class="usage"><code>(-format-stats stats)</code><code>(-format-stats stats sort-field)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L443">view source</a></div></div><div class="public anchor" id="var--if-let-profile"><h3>-if-let-profile</h3><h4 class="type">macro</h4><div class="usage"><code>(-if-let-profile level bindings then else)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L168">view source</a></div></div><div class="public anchor" id="var--if-profile"><h3>-if-profile</h3><h4 class="type">macro</h4><div class="usage"><code>(-if-profile level then else)</code><code>(-if-profile level test then else)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L156">view source</a></div></div><div class="public anchor" id="var--log-profiled"><h3>-log-profiled</h3><h4 class="type">macro</h4><div class="usage"><code>(-log-profiled level id expr-to-profile)</code><code>(-log-profiled level id stats result)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L245">view source</a></div></div><div class="public anchor" id="var--pdata-proxy"><h3>-pdata-proxy</h3><div class="usage"></div><div class="doc"><pre class="plaintext">{&lt;id&gt; &lt;times&gt; :__stats &lt;m-stats&gt; :__clock &lt;m-clock&gt;} iff profiling active
on thread. This is substantially faster than a ^:dynamic atom. Would esp.
benefit from ^:static support / direct linking / a Java class.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L41">view source</a></div></div><div class="public anchor" id="var-chance"><h3>chance</h3><div class="usage"><code>(chance p)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L239">view source</a></div></div><div class="public anchor" id="var-defnp"><h3>defnp</h3><h4 class="type">macro</h4><div class="usage"><code>(defnp name doc-string? attr-map? [params*] prepost-map? body)</code><code>(defnp name doc-string? attr-map? ([params*] prepost-map? body) + attr-map?)</code></div><div class="doc"><pre class="plaintext">Like `defn` but wraps fn bodies with `p` macro.
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L542">view source</a></div></div><div class="public anchor" id="var-dynamic-capture-.3Eprofile"><h3>dynamic-capture-&gt;profile</h3><h4 class="type">macro</h4><div class="usage"><code>(dynamic-capture-&gt;profile level id &amp; body)</code></div><div class="doc"><pre class="plaintext">Experimental, subject to change!
Like `profile` but captures stats from all profiling calls in expr's
dynamic scope.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L413">view source</a></div></div><div class="public anchor" id="var-dynamic-capture-.3Eprofiled"><h3>dynamic-capture-&gt;profiled</h3><h4 class="type">macro</h4><div class="usage"><code>(dynamic-capture-&gt;profiled expr-to-profile params &amp; body)</code></div><div class="doc"><pre class="plaintext">Experimental, subject to change!
Like `profiled` but captures stats from all profiling calls in expr's
dynamic scope.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L399">view source</a></div></div><div class="public anchor" id="var-fnp"><h3>fnp</h3><h4 class="type">macro</h4><div class="usage"><code>(fnp name? [params*] prepost-map? body)</code><code>(fnp name? ([params*] prepost-map? body) +)</code></div><div class="doc"><pre class="plaintext">Like `fn` but wraps fn bodies with `p` macro.
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L525">view source</a></div></div><div class="public anchor" id="var-merge-stats"><h3>merge-stats</h3><div class="usage"><code>(merge-stats s1 s2)</code></div><div class="doc"><pre class="plaintext">Merges stats maps from multiple runs, threads, etc.
Automatically identifies and merges concurrent time windows.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L284">view source</a></div></div><div class="public anchor" id="var-nano-time"><h3>nano-time</h3><h4 class="type">macro</h4><div class="usage"><code>(nano-time)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L32">view source</a></div></div><div class="public anchor" id="var-p"><h3>p</h3><h4 class="type">macro</h4><div class="usage"><code>(p &amp; specs)</code></div><div class="doc"><pre class="plaintext">`pspy` alias
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L241">view source</a></div></div><div class="public anchor" id="var-p*"><h3>p*</h3><h4 class="type">macro</h4><div class="usage"><code>(p* &amp; body)</code></div><div class="doc"><pre class="plaintext">Deprecated
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L562">view source</a></div></div><div class="public anchor" id="var-profile"><h3>profile</h3><h4 class="type">macro</h4><div class="usage"><code>(profile level id &amp; body)</code><code>(profile level id :when test &amp; body)</code></div><div class="doc"><pre class="plaintext">When logging is enabled, executes named body with thread-local profiling
enabled and logs profiling stats. Always returns body's result.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L258">view source</a></div></div><div class="public anchor" id="var-profile-into"><h3>profile-into</h3><h4 class="type">macro</h4><div class="usage"><code>(profile-into ?stats-accumulator level &amp; body)</code><code>(profile-into ?stats-accumulator level :when test &amp; body)</code></div><div class="doc"><pre class="plaintext">Experimental, subject to change!
When logging is enabled, executes body with thread-local profiling
enabled and adds stats to given accumulator. Always returns body's
result. See also `stats-accumulator`.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L374">view source</a></div></div><div class="public anchor" id="var-profiled"><h3>profiled</h3><h4 class="type">macro</h4><div class="usage"><code>(profiled expr-to-profile params &amp; body)</code></div><div class="doc"><pre class="plaintext">Relatively low-level primitive. Executes expr with thread-local profiling
enabled, then executes body with `[?&lt;stats&gt; &lt;expr-result&gt;]` binding, e.g:
  (profiled "foo" [stats result] (do (println stats) result))</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L182">view source</a></div></div><div class="public anchor" id="var-profiling.3F"><h3>profiling?</h3><div class="usage"><code>(profiling?)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L62">view source</a></div></div><div class="public anchor" id="var-pspy"><h3>pspy</h3><h4 class="type">macro</h4><div class="usage"><code>(pspy id &amp; body)</code><code>(pspy level id &amp; body)</code></div><div class="doc"><pre class="plaintext">Profiling spy. When thread-local profiling is enabled, records
execution time of named body. Always returns the body's result.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L212">view source</a></div></div><div class="public anchor" id="var-pspy*"><h3>pspy*</h3><div class="usage"><code>(pspy* _id f)</code></div><div class="doc"><pre class="plaintext">Deprecated
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L561">view source</a></div></div><div class="public anchor" id="var-sampling-profile"><h3>sampling-profile</h3><h4 class="type">macro</h4><div class="usage"><code>(sampling-profile level probability id &amp; body)</code></div><div class="doc"><pre class="plaintext">Deprecated
</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L566">view source</a></div></div><div class="public anchor" id="var-start-profiling.21"><h3>start-profiling!</h3><div class="usage"><code>(start-profiling!)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L64">view source</a></div></div><div class="public anchor" id="var-stats-accumulator"><h3>stats-accumulator</h3><div class="usage"><code>(stats-accumulator)</code></div><div class="doc"><pre class="plaintext">Experimental, subject to change!
Small util to help merge stats maps from multiple threads.
Returns a stateful fn with arities:
  ([stats-map]) ; Accumulates the given stats (you may call this from any thread)
  ([])          ; Deref: returns the merged value of all accumulated stats

See also `profile-into`.</pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L353">view source</a></div></div><div class="public anchor" id="var-stop-profiling.21"><h3>stop-profiling!</h3><div class="usage"><code>(stop-profiling!)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/ptaoussanis/timbre/blob/master/target/classes/taoensso/timbre/profiling.clj#L65">view source</a></div></div></div></body></html>